{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>Recommended Recipes For {{ user.username }}</h1>
</div>

<div class="pantry-preview">
    <h3>My Pantry Preview</h3>
    <div class="pantry-preview-ingredients">
        {% if ingredients %}
        <table class="pantry-preview-table">
            <thead>
                <tr>
                    <th>Ingredient</th>
                    <th>Quantity</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for ingredient in ingredients %}
                <tr>
                    <td><strong>{{ ingredient.name }}</strong></td>
                    <td>{{ ingredient.quantity if ingredient.quantity else '-' }}</td>
                    <td>{{ ingredient.notes if ingredient.notes else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>You don't have any ingredients saved yet. Go to My Pantry to start adding!</p>
        {% endif %}
    </div>
</div>

<div class="recommendation-results">
    <h3>Recommended Recipes</h3>

    <div id="recommendation-results">
        {% if recipes %}
            {% for r in recipes %}
                <div class="recipe-card">
                    <a href="{{ url_for('recipe_details', recipe_id=r.id) }}"><h4>{{ r.name }}</h4></a>
                    <img src="{{ r.image }}" alt="{{ r.name }}" width="120">
                    <p><strong>Matched ingredients:</strong> {{ r.matched_ingredients }}</p>
                    <p><strong>Missing ingredients:</strong>
                        {% if r.missing_ingredients %}{{ r.missing_ingredients | join(', ') }}{% else %}None{% endif %}
                    </p>
                    {% if r.dietary_tags %}
                        <p><strong>Dietary Tags:</strong> {{ r.dietary_tags | join(', ') }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>No recipes found for your pantry.</p>
        {% endif %}
    </div>

    <!-- Recommendation Button -->
    <form method="POST" action="{{ url_for('recommend_recipes') }}">
        <input type="hidden" name="top_n" value="5">
        <button type="submit" class="btn btn-success">Get New Recommendations</button>
    </form>
</div>
{% endblock %}
